import{_ as ie}from"./preload-helper.101896b7.js";import{u as ue}from"./vue-i18n.cjs.f888bd5c.js";import{g as M}from"./header.9390c1c5.js";import{a as ce,u as R}from"./index.ccbc1bbf.js";import{g as A,b as x}from"./formatTime.057ac5b9.js";import{a as fe,b as ge,c as _e,g as E}from"./data.db8b6d88.js";import{r as U}from"./index.b8b1b364.js";import{J as q}from"./index.4ac74e37.js";import{ay as z}from"./index.070d5527.js";import{h as F,r as J,ap as be,K as C,o as ye,a9 as d,ac as we,j as u,k as S,l as P,D as e,x as l,u as r,F as V,Z as B,B as b,C as y,y as Ie,v as h,A as ke}from"./vue.543fafcc.js";import{_ as ve}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.35101cd5.js";import"./storage.b628b270.js";import"./request.b1530b7c.js";import"./index.7038595c.js";import"./index.05309dac.js";import"./index.18e5bded.js";import"./themeConfig.084d7f79.js";import"./keepAliveNames.cf66da55.js";import"./routesList.76e57b72.js";import"./userInfo.2fef1b52.js";import"./loading.7efee3a8.js";import"./tagsViewRoutes.92636029.js";import"./index.3b68140d.js";const he={class:"system-role-container layout-padding"},De={class:"system-role-padding layout-padding-auto layout-padding-view"},Se={class:"system-user-search mb15"},Te=F({name:"systemRole"}),xe=F({...Te,setup(ze){const{t:o}=ue(),N=R(),D=J(),H=be(()=>ie(()=>import("./drawer.9463b648.js"),["assets/drawer.9463b648.js","assets/preload-helper.101896b7.js","assets/vue-i18n.cjs.f888bd5c.js","assets/_commonjsHelpers.35101cd5.js","assets/vue.543fafcc.js","assets/data.db8b6d88.js","assets/index.7038595c.js","assets/request.b1530b7c.js","assets/storage.b628b270.js","assets/index.4ac74e37.js","assets/index.070d5527.js","assets/index.3b68140d.js","assets/header.9390c1c5.js","assets/index.05309dac.js","assets/index.18e5bded.js","assets/themeConfig.084d7f79.js","assets/index.ccbc1bbf.js"])),L=J(),c=C({appList:[],topicList:[],statusList:[]}),n=C({form:{appId:"",delayId:"",taskId:"",status:"",dateSelect:[null,null]},rules:{name:{required:!0,message:o("message.app.validateName"),pattern:/^[0-9a-zA-Z_.-]*$/,trigger:"blur"}}}),p=C({tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:20}}});c.statusList=fe();const i=async()=>{p.tableData.loading=!0;let s={namespaceId:M(),appId:n.form.appId,delayId:n.form.delayId,status:n.form.status,taskId:n.form.taskId,beginTime:0,endTime:0,page:p.tableData.param.pageNum,size:p.tableData.param.pageSize};n.form.dateSelect[0]!==null&&(s.beginTime=A(n.form.dateSelect[0])),n.form.dateSelect[1]!==null&&(s.endTime=A(n.form.dateSelect[1]));let t=await N.getList(s);p.tableData.data=[],t.list.forEach(function(m){p.tableData.data.push({id:m.id,namespaceId:m.namespaceId,appId:m.appId,appName:m.appName,status:m.status,delayId:m.delayId,taskId:m.taskId,topic:m.topic,delayParams:m.delayParams,delayExtra:m.delayExtra,workerAddress:m.workerAddress,createTime:x(m.createTime),executeTime:x(m.executeTime),completeTime:x(m.completeTime)})}),p.tableData.total=t.total,setTimeout(()=>{p.tableData.loading=!1},500)},j=ge(),$=async(s,t)=>{n.form.delayId="";let m=await ce().getList({namespaceId:M(),appId:s,page:1,size:1024});c.topicList=[],m.list.forEach(function(g){c.topicList.push({id:g.id,label:g.topic})}),t&&await i()},T=s=>{!s||s.validate(t=>{if(t)i();else return!1})},O=()=>{n.form.appId="",n.form.delayId="",n.form.status="",n.form.taskId="",n.form.dateSelect=[null,null],i()},Z=s=>{L.value.openDrawer(s)},K=s=>{q.confirm(o("message.delay.instance.stopTitle")+`(${s.taskId})?`,o("message.commonMsg.tip"),{confirmButtonText:o("message.commonBtn.confirm"),cancelButtonText:o("message.commonBtn.cancel"),type:"warning"}).then(async()=>{let t=await N.stop({taskId:s.taskId});if(Number(t.type)>0){z.error(o("message.commonMsg.stopFail"));return}await i(),z.success(o("message.commonMsg.stopSuccess"))}).catch(()=>{})},G=s=>{q.confirm(o("message.delay.instance.deleteTitle")+`(${s.taskId})?`,o("message.commonMsg.tip"),{confirmButtonText:o("message.commonBtn.confirm"),cancelButtonText:o("message.commonBtn.cancel"),type:"warning"}).then(async()=>{await R().delete({taskId:s.taskId}),await i(),z.success(o("message.commonMsg.deleteSuccess"))}).catch(()=>{})},Q=s=>{p.tableData.param.pageSize=s,i()},W=s=>{p.tableData.param.pageNum=s,i()};return ye(async()=>{let s=U.currentRoute.value.query.delayId,t=U.currentRoute.value.query.appId;c.appList=await _e(),s!=null&&t!=null&&(await $(Number(t),!1),n.form.appId=Number(t),n.form.delayId=Number(s)),await i()}),(s,t)=>{const m=d("el-option"),g=d("el-select"),w=d("el-form-item"),_=d("el-col"),X=d("el-input"),Y=d("el-date-picker"),ee=d("ele-Search"),I=d("el-icon"),k=d("el-button"),ae=d("ele-RefreshRight"),te=d("el-row"),le=d("el-form"),f=d("el-table-column"),oe=d("el-tag"),se=d("ele-View"),ne=d("ele-Stopwatch"),re=d("ele-Delete"),me=d("el-table"),de=d("el-pagination"),pe=we("loading");return u(),S("div",he,[P("div",De,[P("div",Se,[e(le,{ref_key:"tableSearchRef",ref:D,"label-width":80,model:n.form,rules:n.rules},{default:l(()=>[e(te,null,{default:l(()=>[e(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:l(()=>[e(w,{label:r(o)("message.app.name"),prop:"appName"},{default:l(()=>[e(g,{modelValue:n.form.appId,"onUpdate:modelValue":t[0]||(t[0]=a=>n.form.appId=a),filterable:"",placeholder:r(o)("message.commonMsg.all"),size:"default",style:{width:"95%"}},{default:l(()=>[(u(!0),S(V,null,B(c.appList,a=>(u(),h(m,{key:a.id,label:a.label,value:a.id,onClick:v=>$(a.id,!0)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:l(()=>[e(w,{label:r(o)("message.delay.instance.topic"),prop:"topic"},{default:l(()=>[e(g,{modelValue:n.form.delayId,"onUpdate:modelValue":t[2]||(t[2]=a=>n.form.delayId=a),filterable:"",placeholder:r(o)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:l(()=>[(u(!0),S(V,null,B(c.topicList,a=>(u(),h(m,{key:a.id,label:a.label,value:a.id,onClick:t[1]||(t[1]=v=>T(D.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:l(()=>[e(w,{label:r(o)("message.delay.instance.status"),prop:"topic"},{default:l(()=>[e(g,{modelValue:n.form.status,"onUpdate:modelValue":t[4]||(t[4]=a=>n.form.status=a),filterable:"",placeholder:r(o)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:l(()=>[(u(!0),S(V,null,B(c.statusList,a=>(u(),h(m,{key:a.id,label:a.label,value:a.id,onClick:t[3]||(t[3]=v=>T(D.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:l(()=>[e(w,{label:r(o)("message.delay.instance.taskId"),prop:"taskId"},{default:l(()=>[e(X,{modelValue:n.form.taskId,"onUpdate:modelValue":t[5]||(t[5]=a=>n.form.taskId=a),size:"default",style:{width:"95%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(_,{xs:8,sm:12,md:8,lg:8,xl:6,class:"mb20"},{default:l(()=>[e(w,{label:r(o)("message.dateMsg.rangeMsg"),prop:"taskId"},{default:l(()=>[e(Y,{modelValue:n.form.dateSelect,"onUpdate:modelValue":t[6]||(t[6]=a=>n.form.dateSelect=a),type:"datetimerange",shortcuts:r(j),"range-separator":"-",size:"default","start-placeholder":r(o)("message.dateMsg.startDate"),"end-placeholder":r(o)("message.dateMsg.endDate")},null,8,["modelValue","shortcuts","start-placeholder","end-placeholder"])]),_:1},8,["label"])]),_:1}),e(_,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:l(()=>[e(k,{size:"default",type:"primary",class:"ml10",onClick:t[7]||(t[7]=a=>T(D.value))},{default:l(()=>[e(I,null,{default:l(()=>[e(ee)]),_:1}),b(" "+y(s.$t("message.commonBtn.query")),1)]),_:1}),e(k,{size:"default",type:"primary",class:"ml10",onClick:t[8]||(t[8]=a=>O())},{default:l(()=>[e(I,null,{default:l(()=>[e(ae)]),_:1}),b(" "+y(s.$t("message.commonBtn.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),Ie((u(),h(me,{data:p.tableData.data,style:{width:"100%"}},{default:l(()=>[e(f,{prop:"taskId",label:r(o)("message.delay.instance.taskId"),"show-overflow-tooltip":""},null,8,["label"]),e(f,{prop:"topic",label:r(o)("message.delay.instance.topic"),"show-overflow-tooltip":""},null,8,["label"]),e(f,{prop:"status",label:r(o)("message.delay.instance.status"),"show-overflow-tooltip":""},{default:l(a=>[e(oe,{class:"ml-2",type:r(E)(a.row.status).tag},{default:l(()=>[b(y(r(E)(a.row.status).label),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(f,{prop:"executeTime",label:r(o)("message.delay.instance.executeTime"),"show-overflow-tooltip":""},null,8,["label"]),e(f,{prop:"completeTime",label:r(o)("message.delay.instance.completeTime"),"show-overflow-tooltip":""},null,8,["label"]),e(f,{prop:"createTime",label:r(o)("message.delay.instance.createTime"),"show-overflow-tooltip":""},null,8,["label"]),e(f,{label:r(o)("message.commonMsg.operation"),width:"300"},{default:l(a=>[e(k,{type:"primary",size:"default",onClick:v=>Z(a.row)},{default:l(()=>[e(I,null,{default:l(()=>[e(se)]),_:1}),b(" "+y(s.$t("message.commonBtn.log")),1)]),_:2},1032,["onClick"]),a.row.status!==5&&a.row.completeTime==="-"?(u(),h(k,{key:0,type:"warning",size:"default",onClick:v=>K(a.row)},{default:l(()=>[e(I,null,{default:l(()=>[e(ne)]),_:1}),b(" "+y(s.$t("message.commonBtn.stop")),1)]),_:2},1032,["onClick"])):ke("",!0),e(k,{type:"danger",size:"default",onClick:v=>G(a.row)},{default:l(()=>[e(I,null,{default:l(()=>[e(re)]),_:1}),b(" "+y(s.$t("message.commonBtn.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[pe,p.tableData.loading]]),e(de,{onSizeChange:Q,onCurrentChange:W,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":p.tableData.param.pageNum,"onUpdate:current-page":t[9]||(t[9]=a=>p.tableData.param.pageNum=a),background:"","page-size":p.tableData.param.pageSize,"onUpdate:page-size":t[10]||(t[10]=a=>p.tableData.param.pageSize=a),layout:"total, sizes, prev, pager, next, jumper",total:p.tableData.total},null,8,["current-page","page-size","total"])]),e(r(H),{ref_key:"JobDrawerRef",ref:L,onRefresh:t[11]||(t[11]=a=>i())},null,512)])}}});const Ye=ve(xe,[["__scopeId","data-v-6e9af1be"]]);export{Ye as default};
