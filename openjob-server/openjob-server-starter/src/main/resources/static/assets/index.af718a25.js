import{_ as pe}from"./preload-helper.101896b7.js";import{u as de}from"./vue-i18n.cjs.f888bd5c.js";import{L as ie}from"./storage.b628b270.js";import{a as ce,u as ue}from"./index.92f8b057.js";import{g as N,b as h}from"./formatTime.057ac5b9.js";import{b as fe,e as ge,c as be,d as A}from"./data.db8b6d88.js";import{g as _e}from"./header.9390c1c5.js";import{h as P,aH as ye,r as E,ap as we,K as z,o as ve,a9 as p,ac as Se,j as u,k as j,l as L,D as e,x as s,u as m,F as R,Z as V,B as _,C as y,y as Te,v as I,A as Ie}from"./vue.543fafcc.js";import{ay as D}from"./index.070d5527.js";import{J as U}from"./index.4ac74e37.js";import{_ as xe}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.35101cd5.js";import"./request.b1530b7c.js";import"./index.7038595c.js";import"./index.05309dac.js";import"./index.18e5bded.js";import"./themeConfig.084d7f79.js";import"./index.3b68140d.js";const he={class:"system-role-container layout-padding"},je={class:"system-role-padding layout-padding-auto layout-padding-view"},De={class:"system-user-search mb15"},ke=P({name:"systemRole"}),Ce=P({...ke,setup(ze){const{t:l}=de(),q=fe(),B=ye(),k=ue(),x=E(),H=we(()=>pe(()=>import("./drawer-standalone.5aea8ea6.js"),["assets/drawer-standalone.5aea8ea6.js","assets/preload-helper.101896b7.js","assets/vue-i18n.cjs.f888bd5c.js","assets/_commonjsHelpers.35101cd5.js","assets/vue.543fafcc.js","assets/index.92f8b057.js","assets/request.b1530b7c.js","assets/storage.b628b270.js","assets/index.4ac74e37.js","assets/index.070d5527.js","assets/index.3b68140d.js","assets/data.db8b6d88.js","assets/index.7038595c.js","assets/header.9390c1c5.js","assets/index.05309dac.js","assets/index.18e5bded.js","assets/themeConfig.084d7f79.js"])),M=E(),f=z({appSelect:[],jobSelect:[],statusSelect:[]}),n=z({form:{appId:"",jobId:"",status:"",id:"",dateSelect:[null,null]},rules:{}}),d=z({tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:20}}});f.statusSelect=ge();const i=async()=>{d.tableData.loading=!0;let r={namespaceId:ie.get("nid"),appId:n.form.appId,jobId:n.form.jobId,status:n.form.status,id:n.form.id,beginTime:0,endTime:0,page:d.tableData.param.pageNum,size:d.tableData.param.pageSize};n.form.dateSelect[0]!==null&&(r.beginTime=N(n.form.dateSelect[0])),n.form.dateSelect[1]!==null&&(r.endTime=N(n.form.dateSelect[1]));let a=await k.getList(r);d.tableData.data=[],a.list.forEach(function(o){d.tableData.data.push({id:o.id,workflowId:o.workflowId,namespaceId:o.namespaceId,appId:o.appId,jobId:o.jobId,processorType:o.processorType,processorInfo:o.processorInfo,executeType:o.executeType,paramsType:o.paramsType,params:o.params,extendParamsType:o.extendParamsType,extendParams:o.extendParams,timeExpressionType:o.timeExpressionType,timeExpression:o.timeExpression,executeStrategy:o.executeStrategy,failRetryTimes:o.failRetryTimes,failRetryInterval:o.failRetryInterval,concurrency:o.concurrency,status:o.status,workerAddress:o.workerAddress,executeTime:h(o.executeTime),completeTime:h(o.completeTime),lastReportTime:h(o.lastReportTime),createTime:h(o.createTime)})}),d.tableData.total=a.total,setTimeout(()=>{d.tableData.loading=!1},500)},$=async(r,a)=>{n.form.jobId="";let o=await ce().getList({namespaceId:_e(),appId:r,page:1,size:1024});f.jobSelect=[],o.list.forEach(function(g){f.jobSelect.push({id:g.id,label:g.name})}),a&&await i()},C=r=>{!r||r.validate(a=>{if(a)i();else return!1})},F=()=>{n.form.appId="",n.form.jobId="",n.form.status="",n.form.id="",n.form.dateSelect=[null,null],i()},J=(r,a)=>{if(a.executeType=="standalone"){M.value.openDrawer(a);return}D.success("Not supported! type="+a.executeType)},O=r=>{U.confirm(l("message.job.instance.stopTitle")+`(${r.id})?`,l("message.commonMsg.tip"),{confirmButtonText:l("message.commonBtn.confirm"),cancelButtonText:l("message.commonBtn.cancel"),type:"warning"}).then(async()=>{let a=await k.stop({id:r.id});if(Number(a.type)>0){D.error(l("message.commonMsg.stopFail"));return}await i(),D.success(l("message.commonMsg.stopSuccess"))}).catch(()=>{})},K=r=>{U.confirm(l("message.job.instance.deleteTitle")+`(${r.id})?`,l("message.commonMsg.tip"),{confirmButtonText:l("message.commonBtn.confirm"),cancelButtonText:l("message.commonBtn.cancel"),type:"warning"}).then(async()=>{await k.delete({id:r.id}),await i(),D.success(l("message.commonMsg.deleteSuccess"))}).catch(()=>{})},Z=r=>{d.tableData.param.pageSize=r,i()},G=r=>{d.tableData.param.pageNum=r,i()};return ve(async()=>{let r=B.currentRoute.value.query.id,a=B.currentRoute.value.query.appId;f.appSelect=await be(),r!=null&&a!=null&&(await $(Number(a),!1),n.form.appId=Number(a),n.form.jobId=Number(r)),await i()}),(r,a)=>{const o=p("el-option"),g=p("el-select"),w=p("el-form-item"),b=p("el-col"),Q=p("el-input"),W=p("el-date-picker"),X=p("ele-Search"),v=p("el-icon"),S=p("el-button"),Y=p("ele-RefreshRight"),ee=p("el-row"),ae=p("el-form"),c=p("el-table-column"),te=p("el-tag"),le=p("ele-View"),oe=p("ele-Stopwatch"),se=p("ele-Delete"),ne=p("el-table"),re=p("el-pagination"),me=Se("loading");return u(),j("div",he,[L("div",je,[L("div",De,[e(ae,{ref_key:"tableSearchRef",ref:x,model:n.form,rules:n.rules},{default:s(()=>[e(ee,null,{default:s(()=>[e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[e(w,{label:m(l)("message.app.name"),prop:"appId"},{default:s(()=>[e(g,{modelValue:n.form.appId,"onUpdate:modelValue":a[0]||(a[0]=t=>n.form.appId=t),filterable:"",class:"m-2",placeholder:m(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(u(!0),j(R,null,V(f.appSelect,t=>(u(),I(o,{key:t.id,label:t.label,value:t.id,onClick:T=>$(t.id,!0)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[e(w,{label:m(l)("message.job.job.name"),prop:"jobId"},{default:s(()=>[e(g,{modelValue:n.form.jobId,"onUpdate:modelValue":a[2]||(a[2]=t=>n.form.jobId=t),filterable:"",placeholder:m(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(u(!0),j(R,null,V(f.jobSelect,t=>(u(),I(o,{key:t.id,label:t.label,value:t.id,onClick:a[1]||(a[1]=T=>C(x.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[e(w,{label:m(l)("message.job.job.status"),prop:"status"},{default:s(()=>[e(g,{modelValue:n.form.status,"onUpdate:modelValue":a[4]||(a[4]=t=>n.form.status=t),filterable:"",placeholder:m(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(u(!0),j(R,null,V(f.statusSelect,t=>(u(),I(o,{key:t.id,label:t.label,value:t.id,onClick:a[3]||(a[3]=T=>C(x.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[e(w,{label:m(l)("message.job.instance.id"),prop:"id"},{default:s(()=>[e(Q,{modelValue:n.form.id,"onUpdate:modelValue":a[5]||(a[5]=t=>n.form.id=t),size:"default",style:{width:"95%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:8,xl:6,class:"mb20"},{default:s(()=>[e(w,{label:m(l)("message.dateMsg.rangeMsg"),prop:"taskId"},{default:s(()=>[e(W,{modelValue:n.form.dateSelect,"onUpdate:modelValue":a[6]||(a[6]=t=>n.form.dateSelect=t),type:"datetimerange",shortcuts:m(q),"range-separator":"-",size:"default","start-placeholder":m(l)("message.dateMsg.startDate"),"end-placeholder":m(l)("message.dateMsg.endDate")},null,8,["modelValue","shortcuts","start-placeholder","end-placeholder"])]),_:1},8,["label"])]),_:1}),e(b,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:s(()=>[e(S,{size:"default",type:"primary",class:"ml10",onClick:a[7]||(a[7]=t=>C(x.value))},{default:s(()=>[e(v,null,{default:s(()=>[e(X)]),_:1}),_(" "+y(r.$t("message.commonBtn.query")),1)]),_:1}),e(S,{size:"default",type:"primary",class:"ml10",onClick:a[8]||(a[8]=t=>F())},{default:s(()=>[e(v,null,{default:s(()=>[e(Y)]),_:1}),_(" "+y(r.$t("message.commonBtn.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),Te((u(),I(ne,{data:d.tableData.data,style:{width:"100%"}},{default:s(()=>[e(c,{prop:"id",label:m(l)("message.job.instance.id"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"jobId",label:m(l)("message.job.instance.jobId"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"status",label:m(l)("message.job.instance.status"),"show-overflow-tooltip":""},{default:s(t=>[e(te,{class:"ml-2",type:m(A)(t.row.status).tag},{default:s(()=>[_(y(m(A)(t.row.status).label),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(c,{prop:"workerAddress",label:m(l)("message.job.instance.workerAddress"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"executeTime",label:m(l)("message.job.instance.executeTime"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"completeTime",label:m(l)("message.job.instance.completeTime"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"lastReportTime",label:m(l)("message.job.instance.lastReportTime"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{prop:"createTime",label:m(l)("message.job.instance.createTime"),"show-overflow-tooltip":""},null,8,["label"]),e(c,{label:m(l)("message.commonMsg.operation"),width:"300"},{default:s(t=>[e(S,{type:"primary",size:"default",onClick:T=>J("update",t.row)},{default:s(()=>[e(v,null,{default:s(()=>[e(le)]),_:1}),_(" "+y(r.$t("message.commonBtn.log")),1)]),_:2},1032,["onClick"]),t.row.status===5?(u(),I(S,{key:0,type:"warning",size:"default",onClick:T=>O(t.row)},{default:s(()=>[e(v,null,{default:s(()=>[e(oe)]),_:1}),_(" "+y(r.$t("message.commonBtn.stop")),1)]),_:2},1032,["onClick"])):Ie("",!0),e(S,{type:"danger",size:"default",onClick:T=>K(t.row)},{default:s(()=>[e(v,null,{default:s(()=>[e(se)]),_:1}),_(" "+y(r.$t("message.commonBtn.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[me,d.tableData.loading]]),e(re,{onSizeChange:Z,onCurrentChange:G,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":d.tableData.param.pageNum,"onUpdate:current-page":a[9]||(a[9]=t=>d.tableData.param.pageNum=t),background:"","page-size":d.tableData.param.pageSize,"onUpdate:page-size":a[10]||(a[10]=t=>d.tableData.param.pageSize=t),layout:"total, sizes, prev, pager, next, jumper",total:d.tableData.total},null,8,["current-page","page-size","total"])]),e(m(H),{ref_key:"StandaloneDrawerRef",ref:M,onRefresh:a[11]||(a[11]=t=>i())},null,512)])}}});const Ge=xe(Ce,[["__scopeId","data-v-1d32c2e6"]]);export{Ge as default};
