import{_ as R}from"./preload-helper.101896b7.js";import{u as ve}from"./vue-i18n.cjs.2a00fe88.js";import{L as Se}from"./storage.b628b270.js";import{a as Te,u as De}from"./index.7c5dfd4e.js";import{g as O,b as h}from"./formatTime.057ac5b9.js";import{c as Ie,f as xe,d as Re,e as q}from"./data.a7368d0d.js";import{g as he}from"./header.9390c1c5.js";import{h as J,aH as ke,r as D,ap as k,K as z,o as je,a9 as d,ac as Ve,j as u,k as j,l as H,D as a,x as s,u as p,F as M,Z as $,B as _,C as y,y as Be,v as I,A as Ce}from"./vue.bd0669ce.js";import{ay as V}from"./index.e8f4f9cf.js";import{J as F}from"./index.f64fca3a.js";import{_ as ze}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.35101cd5.js";import"./request.386cf962.js";import"./index.c3b4fd97.js";import"./index.aa7cec2e.js";import"./themeConfig.cb88f033.js";import"./index.3f2ce315.js";import"./index.ee56f1f7.js";const Me={class:"system-role-container layout-padding"},$e={class:"system-role-padding layout-padding-auto layout-padding-view"},Ee={class:"system-user-search mb15"},Ae=J({name:"systemRole"}),Ne=J({...Ae,setup(Le){const{t:l}=ve(),K=Ie(),E=ke(),B=De(),x=D(),Z=k(()=>R(()=>import("./drawer-standalone.9e29fb77.js"),["assets/drawer-standalone.9e29fb77.js","assets/preload-helper.101896b7.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/index.7c5dfd4e.js","assets/request.386cf962.js","assets/storage.b628b270.js","assets/index.c3b4fd97.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/data.a7368d0d.js","assets/index.3f2ce315.js","assets/header.9390c1c5.js"])),G=k(()=>R(()=>import("./drawer-broadcast.4c2f9706.js"),["assets/drawer-broadcast.4c2f9706.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.a7368d0d.js","assets/index.3f2ce315.js","assets/request.386cf962.js","assets/storage.b628b270.js","assets/index.c3b4fd97.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js"])),Q=k(()=>R(()=>import("./drawer-mapreduce.f1722e21.js"),["assets/drawer-mapreduce.f1722e21.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.a7368d0d.js","assets/index.3f2ce315.js","assets/request.386cf962.js","assets/storage.b628b270.js","assets/index.c3b4fd97.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js"])),W=k(()=>R(()=>import("./drawer-sharding.b053e9bb.js"),["assets/drawer-sharding.b053e9bb.js","assets/vue.bd0669ce.js","assets/vue-i18n.cjs.2a00fe88.js","assets/_commonjsHelpers.35101cd5.js","assets/data.a7368d0d.js","assets/index.3f2ce315.js","assets/request.386cf962.js","assets/storage.b628b270.js","assets/index.c3b4fd97.js","assets/index.aa7cec2e.js","assets/themeConfig.cb88f033.js","assets/index.f64fca3a.js","assets/index.e8f4f9cf.js","assets/index.ee56f1f7.js","assets/header.9390c1c5.js"])),A=D(),N=D(),L=D(),P=D(),f=z({appSelect:[],jobSelect:[],statusSelect:[]}),n=z({form:{appId:"",jobId:"",status:"",id:"",dateSelect:[null,null]},rules:{}}),m=z({tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:20}}});f.statusSelect=xe();const i=async()=>{m.tableData.loading=!0;let r={namespaceId:Se.get("nid"),appId:n.form.appId,jobId:n.form.jobId,status:n.form.status,id:n.form.id,beginTime:0,endTime:0,page:m.tableData.param.pageNum,size:m.tableData.param.pageSize};n.form.dateSelect[0]!==null&&(r.beginTime=O(n.form.dateSelect[0])),n.form.dateSelect[1]!==null&&(r.endTime=O(n.form.dateSelect[1]));let e=await B.getList(r);m.tableData.data=[],e.list.forEach(function(o){m.tableData.data.push({id:o.id,workflowId:o.workflowId,namespaceId:o.namespaceId,appId:o.appId,jobId:o.jobId,processorType:o.processorType,processorInfo:o.processorInfo,executeType:o.executeType,paramsType:o.paramsType,params:o.params,extendParamsType:o.extendParamsType,extendParams:o.extendParams,timeExpressionType:o.timeExpressionType,timeExpression:o.timeExpression,executeStrategy:o.executeStrategy,failRetryTimes:o.failRetryTimes,failRetryInterval:o.failRetryInterval,concurrency:o.concurrency,status:o.status,workerAddress:o.workerAddress,executeTime:h(o.executeTime),completeTime:h(o.completeTime),lastReportTime:h(o.lastReportTime),createTime:h(o.createTime)})}),m.tableData.total=e.total,setTimeout(()=>{m.tableData.loading=!1},500)},X=async()=>{},Y=async()=>{},ee=async()=>{},U=async(r,e)=>{n.form.jobId="";let o=await Te().getList({namespaceId:he(),appId:r,page:1,size:1024});f.jobSelect=[],o.list.forEach(function(g){f.jobSelect.push({id:g.id,label:g.name})}),e&&await i()},C=r=>{!r||r.validate(e=>{if(e)i();else return!1})},ae=()=>{n.form.appId="",n.form.jobId="",n.form.status="",n.form.id="",n.form.dateSelect=[null,null],i()},te=(r,e)=>{if(e.executeType=="standalone"){A.value.openDrawer(e);return}if(e.executeType=="broadcast"){L.value.openDrawer(e);return}if(e.executeType=="mapReduce"){P.value.openDrawer(e);return}if(e.executeType=="sharding"){N.value.openDrawer(e);return}V.success("Not supported! type="+e.executeType)},le=r=>{F.confirm(l("message.job.instance.stopTitle")+`(${r.id})?`,l("message.commonMsg.tip"),{confirmButtonText:l("message.commonBtn.confirm"),cancelButtonText:l("message.commonBtn.cancel"),type:"warning"}).then(async()=>{let e=await B.stop({id:r.id});if(Number(e.type)>0){V.error(l("message.commonMsg.stopFail"));return}await i(),V.success(l("message.commonMsg.stopSuccess"))}).catch(()=>{})},oe=r=>{F.confirm(l("message.job.instance.deleteTitle")+`(${r.id})?`,l("message.commonMsg.tip"),{confirmButtonText:l("message.commonBtn.confirm"),cancelButtonText:l("message.commonBtn.cancel"),type:"warning"}).then(async()=>{await B.delete({id:r.id}),await i(),V.success(l("message.commonMsg.deleteSuccess"))}).catch(()=>{})},se=r=>{m.tableData.param.pageSize=r,i()},ne=r=>{m.tableData.param.pageNum=r,i()};return je(async()=>{let r=E.currentRoute.value.query.id,e=E.currentRoute.value.query.appId;f.appSelect=await Re(),r!=null&&e!=null&&(await U(Number(e),!1),n.form.appId=Number(e),n.form.jobId=Number(r)),await i()}),(r,e)=>{const o=d("el-option"),g=d("el-select"),w=d("el-form-item"),b=d("el-col"),re=d("el-input"),pe=d("el-date-picker"),de=d("ele-Search"),v=d("el-icon"),S=d("el-button"),me=d("ele-RefreshRight"),ie=d("el-row"),ce=d("el-form"),c=d("el-table-column"),ue=d("el-tag"),fe=d("ele-View"),ge=d("ele-Stopwatch"),be=d("ele-Delete"),_e=d("el-table"),ye=d("el-pagination"),we=Ve("loading");return u(),j("div",Me,[H("div",$e,[H("div",Ee,[a(ce,{ref_key:"tableSearchRef",ref:x,model:n.form,rules:n.rules},{default:s(()=>[a(ie,null,{default:s(()=>[a(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(l)("message.app.name"),prop:"appId"},{default:s(()=>[a(g,{modelValue:n.form.appId,"onUpdate:modelValue":e[0]||(e[0]=t=>n.form.appId=t),filterable:"",class:"m-2",placeholder:p(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(u(!0),j(M,null,$(f.appSelect,t=>(u(),I(o,{key:t.id,label:t.label,value:t.id,onClick:T=>U(t.id,!0)},null,8,["label","value","onClick"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(l)("message.job.job.name"),prop:"jobId"},{default:s(()=>[a(g,{modelValue:n.form.jobId,"onUpdate:modelValue":e[2]||(e[2]=t=>n.form.jobId=t),filterable:"",placeholder:p(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(u(!0),j(M,null,$(f.jobSelect,t=>(u(),I(o,{key:t.id,label:t.label,value:t.id,onClick:e[1]||(e[1]=T=>C(x.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(l)("message.job.job.status"),prop:"status"},{default:s(()=>[a(g,{modelValue:n.form.status,"onUpdate:modelValue":e[4]||(e[4]=t=>n.form.status=t),filterable:"",placeholder:p(l)("message.commonMsg.all"),size:"default",style:{width:"90%"}},{default:s(()=>[(u(!0),j(M,null,$(f.statusSelect,t=>(u(),I(o,{key:t.id,label:t.label,value:t.id,onClick:e[3]||(e[3]=T=>C(x.value))},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(b,{xs:8,sm:12,md:8,lg:4,xl:4,class:"mb20"},{default:s(()=>[a(w,{label:p(l)("message.job.instance.id"),prop:"id"},{default:s(()=>[a(re,{modelValue:n.form.id,"onUpdate:modelValue":e[5]||(e[5]=t=>n.form.id=t),size:"default",style:{width:"95%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),a(b,{xs:8,sm:12,md:8,lg:8,xl:6,class:"mb20"},{default:s(()=>[a(w,{label:p(l)("message.dateMsg.rangeMsg"),prop:"taskId"},{default:s(()=>[a(pe,{modelValue:n.form.dateSelect,"onUpdate:modelValue":e[6]||(e[6]=t=>n.form.dateSelect=t),type:"datetimerange",shortcuts:p(K),"range-separator":"-",size:"default","start-placeholder":p(l)("message.dateMsg.startDate"),"end-placeholder":p(l)("message.dateMsg.endDate")},null,8,["modelValue","shortcuts","start-placeholder","end-placeholder"])]),_:1},8,["label"])]),_:1}),a(b,{xs:8,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:s(()=>[a(S,{size:"default",type:"primary",class:"ml10",onClick:e[7]||(e[7]=t=>C(x.value))},{default:s(()=>[a(v,null,{default:s(()=>[a(de)]),_:1}),_(" "+y(r.$t("message.commonBtn.query")),1)]),_:1}),a(S,{size:"default",type:"primary",class:"ml10",onClick:e[8]||(e[8]=t=>ae())},{default:s(()=>[a(v,null,{default:s(()=>[a(me)]),_:1}),_(" "+y(r.$t("message.commonBtn.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),Be((u(),I(_e,{data:m.tableData.data,style:{width:"100%"}},{default:s(()=>[a(c,{prop:"id",label:p(l)("message.job.instance.id"),"show-overflow-tooltip":""},null,8,["label"]),a(c,{prop:"jobId",label:p(l)("message.job.instance.jobId"),"show-overflow-tooltip":""},null,8,["label"]),a(c,{prop:"status",label:p(l)("message.job.instance.status"),"show-overflow-tooltip":""},{default:s(t=>[a(ue,{class:"ml-2",type:p(q)(t.row.status).tag},{default:s(()=>[_(y(p(q)(t.row.status).label),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(c,{prop:"workerAddress",label:p(l)("message.job.instance.workerAddress"),"show-overflow-tooltip":""},null,8,["label"]),a(c,{prop:"executeTime",label:p(l)("message.job.instance.executeTime"),"show-overflow-tooltip":""},null,8,["label"]),a(c,{prop:"completeTime",label:p(l)("message.job.instance.completeTime"),"show-overflow-tooltip":""},null,8,["label"]),a(c,{prop:"lastReportTime",label:p(l)("message.job.instance.lastReportTime"),"show-overflow-tooltip":""},null,8,["label"]),a(c,{prop:"createTime",label:p(l)("message.job.instance.createTime"),"show-overflow-tooltip":""},null,8,["label"]),a(c,{label:p(l)("message.commonMsg.operation"),width:"300"},{default:s(t=>[a(S,{type:"primary",size:"default",onClick:T=>te("update",t.row)},{default:s(()=>[a(v,null,{default:s(()=>[a(fe)]),_:1}),_(" "+y(r.$t("message.commonBtn.log")),1)]),_:2},1032,["onClick"]),t.row.status===5?(u(),I(S,{key:0,type:"warning",size:"default",onClick:T=>le(t.row)},{default:s(()=>[a(v,null,{default:s(()=>[a(ge)]),_:1}),_(" "+y(r.$t("message.commonBtn.stop")),1)]),_:2},1032,["onClick"])):Ce("",!0),a(S,{type:"danger",size:"default",onClick:T=>oe(t.row)},{default:s(()=>[a(v,null,{default:s(()=>[a(be)]),_:1}),_(" "+y(r.$t("message.commonBtn.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[we,m.tableData.loading]]),a(ye,{onSizeChange:se,onCurrentChange:ne,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":m.tableData.param.pageNum,"onUpdate:current-page":e[9]||(e[9]=t=>m.tableData.param.pageNum=t),background:"","page-size":m.tableData.param.pageSize,"onUpdate:page-size":e[10]||(e[10]=t=>m.tableData.param.pageSize=t),layout:"total, sizes, prev, pager, next, jumper",total:m.tableData.total},null,8,["current-page","page-size","total"])]),a(p(Z),{ref_key:"StandaloneDrawerRef",ref:A,onRefresh:e[11]||(e[11]=t=>i())},null,512),a(p(G),{ref_key:"BroadcastDrawerRef",ref:L,onRefresh:e[12]||(e[12]=t=>X())},null,512),a(p(Q),{ref_key:"MapReduceDrawerRef",ref:P,onRefresh:e[13]||(e[13]=t=>Y())},null,512),a(p(W),{ref_key:"ShardingDrawerRef",ref:N,onRefresh:e[14]||(e[14]=t=>ee())},null,512)])}}});const oa=ze(Ne,[["__scopeId","data-v-4bcfcb9b"]]);export{oa as default};
